<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>√Årvore de Talentos</title>

  <!-- Tailwind via official CDN script (injects generated CSS) -->
  <!-- this will download the full utility stylesheet at runtime -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- fallback basic styling in case Tailwind script is blocked or you are offline -->
  <style>
    body { background-color: #0f172a; color: #f8fafc; font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; }
    button { cursor: pointer; }
    .bg-slate-950 { background-color: #0f172a !important; }
    .text-slate-100 { color: #f8fafc !important; }
    .bg-slate-900 { background-color: #1e293b !important; }
    .text-white { color: #ffffff !important; }
    /* add more fallbacks as needed */
  </style>

  <!-- React + ReactDOM UMD -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>

  <!-- Babel para transpilar JSX no cliente -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <!-- (removed lucide icons; we'll use simple placeholders instead) -->

  <!-- Firebase v9 compat UMD builds -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
</head>
<body class="bg-slate-950 text-slate-100">
  <div id="root"></div>

  <script type="text/babel">
    // debugging helpers ‚Äì will print in console so you see if script executed
    console.log('babel script running');
    window.addEventListener('error', e => {
      console.error('global error:', e.error || e.message);
    });
    // a partir de agora usamos as vari√°veis globais fornecidas pelos CDN's
    const { useState, useEffect } = React;
    // icon placeholders - simple emoji/text components
    const makeIcon = label => props => <span {...props}>{label}</span>;
    const Shield = makeIcon('üõ°Ô∏è');
    const Sword = makeIcon('‚öîÔ∏è');
    const Wand2 = makeIcon('üßôüèæ‚Äç‚ôÇÔ∏è');
    const Scroll = makeIcon('üìú');
    const User = makeIcon('üë§');
    const Lock = makeIcon('üîí');
    const CheckCircle2 = makeIcon('‚úÖ');
    const AlertTriangle = makeIcon('‚ö†Ô∏è');
    const ChevronRight = makeIcon('‚ñ∂Ô∏è');
    const Info = makeIcon('‚ÑπÔ∏è');
    const Users = makeIcon('üë•');
    const Star = makeIcon('‚≠ê');
    const Zap = makeIcon('‚ö°');
    const Hammer = makeIcon('üî®');
    const FlaskConical = makeIcon('‚öóÔ∏è');
    const Ghost = makeIcon('üëª');
    const MessageSquare = makeIcon('üí¨');
    const Crown = makeIcon('üëë');
    const Flame = makeIcon('üî•');
    const Wind = makeIcon('üå¨Ô∏è');
    const Target = makeIcon('üéØ');
    const ShieldAlert = makeIcon('üõ°Ô∏è‚ö†Ô∏è');
    const Dna = makeIcon('üß¨');
    const Ear = makeIcon('üëÇ');
    const Sun = makeIcon('‚òÄÔ∏è');
    const Moon = makeIcon('üåô');
    const Footprints = makeIcon('üë£');
    const Brain = makeIcon('üß†');
    const Eye = makeIcon('üëÅÔ∏è');
    const Crosshair = makeIcon('üéØ');
    const HeartPulse = makeIcon('üíì');
    const Sparkles = makeIcon('‚ú®');

    const { initializeApp } = firebase;
    // compat API: use global firebase.auth() and firebase.firestore()

    // --- CONFIGURA√á√ÉO FIREBASE ---
    const firebaseConfig = typeof __firebase_config !== 'undefined'
      ? JSON.parse(__firebase_config)
      : {
          apiKey: "AIzaSyCzR5bU-ou_Cz_yxugkA2eXd_3zf86ojgw",
          authDomain: "rpg-talenttree.firebaseapp.com",
          projectId: "rpg-talenttree",
          storageBucket: "rpg-talenttree.firebasestorage.app",
          messagingSenderId: "981095423243",
          appId: "1:981095423243:web:77d651b1715e08b3d4960e",
          measurementId: "G-EEE5ZB2K8Q"
        };

    const appId = typeof __app_id !== 'undefined' ? __app_id : 'rpg-mega-trees-v7';
    const app = initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    // --- DADOS DAS √ÅRVORES (8 √Årvores x 4 Habilidades x 3 N√≠veis) ---
    const TALENT_TREES = {
      marcial: {
        title: "Senda do Guerreiro",
        icon: <Sword className="w-6 h-6" />,
        color: "bg-red-900",
        border: "border-red-500",
        description: "Dom√≠nio f√≠sico e t√°tico. Ideal para combatentes de linha de frente.",
        talents: [
          { id: 'm1', name: "Robustez", icon: <ShieldAlert size={14}/>, levels: [
              { lv: 1, req: "Sofrer 100 de dano", effect: "+1 PV por n√≠vel.", desc: "Sua pele engrossa ap√≥s cicatrizes." },
              { lv: 2, req: "Robustez I + 300 dano", effect: "+2 PV por n√≠vel.", desc: "Seu corpo ignora ferimentos superficiais." },
              { lv: 3, req: "Robustez II + Sobreviver com 1 PV", effect: "+3 PV/Lv e +1 CA.", desc: "Uma lenda que se recusa a cair." }
          ]},
          { id: 'm2', name: "Ataque Oportunista", icon: <Target size={14}/>, levels: [
              { lv: 1, req: "20 rea√ß√µes de ataque", effect: "Vantagem em ataques de oportunidade.", desc: "Reflexos sintonizados com a falha alheia." },
              { lv: 2, req: "Oportunista I + 10 abates", effect: "Inimigo atingido tem deslocamento 0.", desc: "Ningu√©m escapa do seu alcance." },
              { lv: 3, req: "Oportunista II + 50 rea√ß√µes", effect: "Pode fazer 2 rea√ß√µes por rodada.", desc: "Um turbilh√£o defensivo intranspon√≠vel." }
          ]},
          { id: 'm3', name: "F√∫ria", icon: <Flame size={14}/>, levels: [
              { lv: 1, req: "HP < 50% em 5 lutas", effect: "+2 dano enquanto ferido.", desc: "A dor alimenta sua raiva." },
              { lv: 2, req: "F√∫ria I + 30 abates", effect: "Cr√≠tico agora √© 19-20.", desc: "Golpes buscam pontos vitais." },
              { lv: 3, req: "F√∫ria II + Abater Chefe", effect: "Resist√™ncia a dano f√≠sico.", desc: "Sua raiva √© uma armadura." }
          ]},
          { id: 'm4', name: "Comandante", icon: <Crown size={14}/>, levels: [
              { lv: 1, req: "Dar 10 comandos t√°ticos", effect: "Aliado ganha +1 no ataque contra seu alvo.", desc: "Sua voz guia o a√ßo aliado." },
              { lv: 2, req: "Comandante I + Flanquear 20x", effect: "Pode usar ajuda como a√ß√£o b√¥nus.", desc: "Mestre da coordena√ß√£o de campo." },
              { lv: 3, req: "Comandante II + Vit√≥ria Cr√≠tica", effect: "Sua iniciativa √© passada para um aliado.", desc: "Estrategista brilhante." }
          ]}
        ]
      },
      arcano: {
        title: "Caminho do Saber",
        icon: <Wand2 className="w-6 h-6" />,
        color: "bg-blue-900",
        border: "border-blue-500",
        description: "Manipula√ß√£o da Trama e segredos arcanos do cosmos.",
        talents: [
          { id: 'a1', name: "Mente Clara", icon: <Zap size={14}/>, levels: [
              { lv: 1, req: "10 sucessos em concentra√ß√£o", effect: "N√£o perde concentra√ß√£o com dano < 10.", desc: "Mente inabal√°vel." },
              { lv: 2, req: "Mente I + 50 magias", effect: "Vantagem em testes de resist√™ncia de INT.", desc: "Psique labir√≠ntica." },
              { lv: 3, req: "Mente II + Meditar em plano", effect: "Pode manter 2 concentra√ß√µes.", desc: "Dualidade mental." }
          ]},
          { id: 'a2', name: "Tecel√£o", icon: <Wind size={14}/>, levels: [
              { lv: 1, req: "Gastar 30 slots lv 1+", effect: "Recupera 1 slot lv 1 em descanso curto.", desc: "Reciclagem de energia." },
              { lv: 2, req: "Tecel√£o I + Aprender 5 magias", effect: "Pode trocar uma magia preparada.", desc: "Versatilidade m√°gica." },
              { lv: 3, req: "Tecel√£o II + Slot lv 5", effect: "Conjura lv 1 sem slot 3x/dia.", desc: "A magia flui livremente." }
          ]},
          { id: 'a3', name: "Pot√™ncia", icon: <Flame size={14}/>, levels: [
              { lv: 1, req: "200 dano m√°gico", effect: "Rola 1s no dano novamente.", desc: "M√°ximo impacto m√°gico." },
              { lv: 2, req: "Pot√™ncia I + 50 abates", effect: "Ignora resist√™ncias elementais.", desc: "O fogo queima at√© o fogo." },
              { lv: 3, req: "Pot√™ncia II + Cr√≠tico", effect: "+1 dado de dano em magias.", desc: "Destrui√ß√£o absoluta." }
          ]},
          { id: 'a4', name: "Metamagia", icon: <Sparkles size={14}/>, levels: [
              { lv: 1, req: "Modificar 10 magias", effect: "Pode dobrar o alcance de uma magia (3x/dia).", desc: "Sua vontade estica a trama." },
              { lv: 2, req: "Metamagia I + Usar 3 elementos", effect: "Magias de alvo √∫nico atingem 2 alvos pr√≥ximos.", desc: "Magia duplicada." },
              { lv: 3, req: "Metamagia II + Desvendar selo", effect: "Remove componentes verbais de qualquer magia.", desc: "Conjun√ß√£o silenciosa." }
          ]}
        ]
      },
      divino: {
        title: "Senda Divina",
        icon: <Sun className="w-6 h-6" />,
        color: "bg-amber-900",
        border: "border-amber-400",
        description: "Conex√£o com deuses e luz sagrada. Cura e puni√ß√£o divina.",
        talents: [
          { id: 'd1', name: "Cura Sagrada", icon: <HeartPulse size={14}/>, levels: [
              { lv: 1, req: "Curar 200 PV", effect: "Dados de cura rolam +1.", desc: "Suas m√£os brilham com calor divino." },
              { lv: 2, req: "Cura I + Estabilizar 10 aliados", effect: "Curas removem a condi√ß√£o 'Cego' ou 'Surdo'.", desc: "Milagre restaurador." },
              { lv: 3, req: "Cura II + Ressuscitar algu√©m", effect: "Sempre cura o valor m√°ximo em aliados com < 50% HP.", desc: "O √°pice da benevol√™ncia." }
          ]},
          { id: 'd2', name: "Escudo da F√©", icon: <Shield size={14}/>, levels: [
              { lv: 1, req: "Bloquear dano para aliado", effect: "Aliados a 3m ganham +1 CA.", desc: "Sua f√© √© um domo protetor." },
              { lv: 2, req: "Escudo I + Resistir a 20 feiti√ßos", effect: "Resist√™ncia a dano Necr√≥tico.", desc: "A luz repele a morte." },
              { lv: 3, req: "Escudo II + Banir dem√¥nio", effect: "Dano recebido por aliados pr√≥ximos √© dividido com voc√™.", desc: "M√°rtir sagrado." }
          ]},
          { id: 'd3', name: "Luz Punidora", icon: <Zap size={14}/>, levels: [
              { lv: 1, req: "Abater 10 mortos-vivos", effect: "+1d6 dano Radiante em ataques m√°gicos.", desc: "A escurid√£o foge de voc√™." },
              { lv: 2, req: "Luz I + Cegar 5 inimigos", effect: "Alvos atingidos ficam impedidos de usar rea√ß√µes.", desc: "Clar√£o paralisante." },
              { lv: 3, req: "Luz II + Purificar solo", effect: "Cr√≠tico contra profanos causa explos√£o de luz.", desc: "Julgamento final." }
          ]},
          { id: 'd4', name: "Intercess√£o", icon: <MessageSquare size={14}/>, levels: [
              { lv: 1, req: "Rezar por 30 turnos", effect: "Pode gastar rea√ß√£o para dar vantagem em teste de resist√™ncia.", desc: "Ouvido por for√ßas maiores." },
              { lv: 2, req: "Intercess√£o I + 10 milagres", effect: "O deuso responde 1 pergunta por dia (Sim/N√£o).", desc: "Comunh√£o direta." },
              { lv: 3, req: "Intercess√£o II + Salvar Vila", effect: "Pode invocar um Avatar por 1 turno (1x/m√™s).", desc: "Voz do pante√£o." }
          ]}
        ]
      },
      sombras: {
        title: "Senda das Sombras",
        icon: <Moon className="w-6 h-6" />,
        color: "bg-slate-900",
        border: "border-indigo-500",
        description: "Infiltra√ß√£o, assassinato e manipula√ß√£o do breu.",
        talents: [
          { id: 'sh1', name: "L√¢mina T√≥xica", icon: <FlaskConical size={14}/>, levels: [
              { lv: 1, req: "Envenenar 10 alvos", effect: "Armas causam +1d4 veneno (1min ap√≥s aplicar).", desc: "O a√ßo que arde." },
              { lv: 2, req: "L√¢mina I + Extrair veneno", effect: "O veneno agora causa a condi√ß√£o 'Lento'.", desc: "Toxina debilitante." },
              { lv: 3, req: "L√¢mina II + Matar Rei", effect: "Ignora imunidade a veneno de criaturas vivas.", desc: "Veneno da vi√∫va negra." }
          ]},
          { id: 'sh2', name: "Furtividade Ativa", icon: <Ghost size={14}/>, levels: [
              { lv: 1, req: "Passar despercebido 20x", effect: "Inimigos t√™m -5 na Percep√ß√£o Passiva contra voc√™.", desc: "Um borr√£o na vis√£o." },
              { lv: 2, req: "Furtividade I + Roubar joia", effect: "Pode se esconder mesmo sob observa√ß√£o leve.", desc: "Mimetismo sombrio." },
              { lv: 3, req: "Furtividade II + Invadir Plano", effect: "Fica invis√≠vel por 1 turno ap√≥s matar um alvo.", desc: "O espectro da morte." }
          ]},
          { id: 'sh3', name: "Ataque Brutal", icon: <Crosshair size={14}/>, levels: [
              { lv: 1, req: "15 ataques com vantagem", effect: "Ataque surpresa d√° +2d6 dano.", desc: "Onde d√≥i mais." },
              { lv: 2, req: "Brutal I + 10 cr√≠ticos", effect: "Se o alvo estiver com 100% HP, o ataque √© cr√≠tico autom√°tico.", desc: "Primeiro e √∫ltimo golpe." },
              { lv: 3, req: "Brutal II + Abate silencioso", effect: "Triplica o dano em ataques contra alvos surpresos.", desc: "Execu√ß√£o perfeita." }
          ]},
          { id: 'sh4', name: "Agilidade Oculta", icon: <Footprints size={14}/>, levels: [
              { lv: 1, req: "Esquivar de 30 ataques", effect: "Desengajar √© a√ß√£o livre.", desc: "Enguia humana." },
              { lv: 2, req: "Agilidade I + Saltar 50m", effect: "Pode escalar qualquer superf√≠cie sem teste.", desc: "Passos de aranha." },
              { lv: 3, req: "Agilidade II + Cair de 20m", effect: "Recebe 0 dano de queda (at√© 30m).", desc: "Pouso de folha." }
          ]}
        ]
      },
      sobrevivencia: {
        title: "Instinto Selvagem",
        icon: <Shield className="w-6 h-6" />,
        color: "bg-emerald-900",
        border: "border-emerald-500",
        description: "Resili√™ncia da natureza e adapta√ß√£o extrema.",
        talents: [
          { id: 's1', name: "Pele de Carvalho", icon: <Dna size={14}/>, levels: [
              { lv: 1, req: "Cair para 0 PV 3x", effect: "Mod. Con na CA (sem armadura).", desc: "Corpo moldado pela dor." },
              { lv: 2, req: "Pele I + Comer monstro", effect: "Resist√™ncia a Veneno.", desc: "Sangue ant√≠doto." },
              { lv: 3, req: "Pele II + Sobreviver queda", effect: "RD 3 contra concuss√£o.", desc: "Ossos de ferro." }
          ]},
          { id: 's2', name: "Rastreador", icon: <Target size={14}/>, levels: [
              { lv: 1, req: "Achar 10 pistas", effect: "Vantagem em Sobreviv√™ncia.", desc: "O ch√£o conta hist√≥rias." },
              { lv: 2, req: "Rastreador I + Noite selva", effect: "Vis√£o Escuro +18m.", desc: "Olhos de lobo." },
              { lv: 3, req: "Rastreador II + Dire√ß√£o", effect: "Sempre sabe onde est√° √°gua e o norte.", desc: "B√∫ssola biol√≥gica." }
          ]},
          { id: 's3', name: "Adapta√ß√£o", icon: <Zap size={14}/>, levels: [
              { lv: 1, req: "Dano elemental", effect: "Reduz dano Fogo/Gelo em 2.", desc: "Ajuste t√©rmico." },
              { lv: 2, req: "Adapta√ß√£o I + 5 resists", effect: "Respira sob √°gua por 1h.", desc: "Pulm√µes anf√≠bios." },
              { lv: 3, req: "Adapta√ß√£o II + Viagem", effect: "Resist√™ncia elemental troc√°vel em descanso longo.", desc: "Mimetismo total." }
          ]},
          { id: 's4', name: "Mestre das Feras", icon: <Ear size={14}/>, levels: [
              { lv: 1, req: "Domar 3 animais", effect: "Pode entender emo√ß√µes de animais.", desc: "Empatia selvagem." },
              { lv: 2, req: "Feras I + Combate com pet", effect: "Pode usar os sentidos do seu animal (100m).", desc: "Olhos da √°guia." },
              { lv: 3, req: "Feras II + Salvar esp√©cie", effect: "Pode invocar um enxame para ajudar (1x/dia).", desc: "Chamado da matilha." }
          ]}
        ]
      },
      utilidade: {
        title: "Mestre de Of√≠cios",
        icon: <Scroll className="w-6 h-6" />,
        color: "bg-amber-800",
        border: "border-amber-500",
        description: "Conhecimento t√©cnico, suporte e cria√ß√£o.",
        talents: [
          { id: 'u1', name: "Alquimia", icon: <FlaskConical size={14}/>, levels: [
              { lv: 1, req: "20 ervas", effect: "Cria 2 po√ß√µes cura/dia.", desc: "Misturas b√°sicas." },
              { lv: 2, req: "Alquimia I + 10 po√ß√µes", effect: "Po√ß√µes curam valor m√°ximo.", desc: "Pureza absoluta." },
              { lv: 3, req: "Alquimia II + Veneno", effect: "Cria ant√≠dotos universais.", desc: "Apotec√°rio lend√°rio." }
          ]},
          { id: 'u2', name: "Ferraria", icon: <Hammer size={14}/>, levels: [
              { lv: 1, req: "30 itens reparados", effect: "Armas aliadas +1 dano.", desc: "Manuten√ß√£o de mestre." },
              { lv: 2, req: "Ferraria I + Forjar a√ßo", effect: "Refor√ßa armadura (+1 CA tempo).", desc: "Forja de campo." },
              { lv: 3, req: "Ferraria II + Forja lend", effect: "Equipamento n√£o quebra.", desc: "A√ßo eterno." }
          ]},
          { id: 'u3', name: "Ladinagem", icon: <Ghost size={14}/>, levels: [
              { lv: 1, req: "15 trancas", effect: "Dobro de profici√™ncia Gazuas.", desc: "M√£os leves." },
              { lv: 2, req: "Ladinagem I + Furtar", effect: "Esconde-se como b√¥nus.", desc: "Fantasma." },
              { lv: 3, req: "Ladinagem II + Invadir", effect: "N√£o ativa armadilhas mec√¢nicas.", desc: "Sombra." }
          ]},
          { id: 'u4', name: "Lideran√ßa", icon: <Crown size={14}/>, levels: [
              { lv: 1, req: "30 ajudas", effect: "A√ß√£o ajudar d√° +1d6.", desc: "Incentivo t√°tico." },
              { lv: 2, req: "Lideran√ßa I + Vit√≥ria", effect: "Aliados +3m deslocamento.", desc: "Comandante nato." },
              { lv: 3, req: "Lideran√ßa II + 100 ajudas", effect: "Vantagem em saves para aliados pr√≥ximos.", desc: "Farol de esperan√ßa." }
          ]}
        ]
      },
      primal: {
        title: "Senda Primal",
        icon: <Flame className="w-6 h-6" />,
        color: "bg-orange-950",
        border: "border-orange-500",
        description: "Conex√£o elemental bruta e instintos ancestrais de destrui√ß√£o.",
        talents: [
          { id: 'p1', name: "Mimetismo Terra", icon: <Shield size={14}/>, levels: [
              { lv: 1, req: "Enterrado vivo", effect: "Ganha 5 PV tempor√°rios ao tocar o solo.", desc: "P√©s firmes na terra." },
              { lv: 2, req: "Terra I + 10 abates pedra", effect: "N√£o pode ser derrubado (prone).", desc: "Estabilidade de montanha." },
              { lv: 3, req: "Terra II + Escavar t√∫nel", effect: "Corpo de pedra: RD 5 contra f√≠sico.", desc: "Mon√≥lito vivo." }
          ]},
          { id: 'p2', name: "Sopro de Fogo", icon: <Flame size={14}/>, levels: [
              { lv: 1, req: "Sobreviver fogo", effect: "Ataques causam +1 fogo.", desc: "Brasas nas veias." },
              { lv: 2, req: "Fogo I + 50 dano chamas", effect: "Resist√™ncia a Fogo.", desc: "Pele de salamandra." },
              { lv: 3, req: "Fogo II + Queimar floresta", effect: "Pode lan√ßar M√£os Flamejantes 3x/dia.", desc: "Drag√£o em forma humana." }
          ]},
          { id: 'p3', name: "Velocidade Vento", icon: <Wind size={14}/>, levels: [
              { lv: 1, req: "Correr 1km em combate", effect: "+1.5m deslocamento.", desc: "Leve como a brisa." },
              { lv: 2, req: "Vento I + Esquivar flecha", effect: "Ataques √† dist√¢ncia contra voc√™ t√™m desvantagem.", desc: "Desvio aerodin√¢mico." },
              { lv: 3, req: "Vento II + Cair de nuvem", effect: "Pode levitar por 1 minuto (1x/dia).", desc: "Filho do vendaval." }
          ]},
          { id: 'p4', name: "Chamado Mar", icon: <Zap size={14}/>, levels: [
              { lv: 1, req: "Nadar 500m", effect: "Deslocamento de nata√ß√£o igual ao normal.", desc: "Fluidez aqu√°tica." },
              { lv: 2, req: "Mar I + Pescar monstro", effect: "Ataques causam +1d4 raio na √°gua.", desc: "Corrente el√©trica." },
              { lv: 3, req: "Mar II + Sobreviver abismo", effect: "Pode respirar √°gua e falar com peixes.", desc: "Avatar das profundezas." }
          ]}
        ]
      },
      mental: {
        title: "Senda Mental",
        icon: <Brain className="w-6 h-6" />,
        color: "bg-purple-950",
        border: "border-purple-400",
        description: "Poderes ps√≠quicos e manipula√ß√£o da consci√™ncia.",
        talents: [
          { id: 'ps1', name: "Telecinese", icon: <Zap size={14}/>, levels: [
              { lv: 1, req: "Mover 50 objetos", effect: "M√£os M√°gicas invis√≠veis permanentes.", desc: "Mente sobre mat√©ria." },
              { lv: 2, req: "Ps1 + Empurrar gigante", effect: "Pode empurrar inimigo 3m com a√ß√£o b√¥nus.", desc: "Pulso cin√©tico." },
              { lv: 3, req: "Ps2 + Levitar casa", effect: "Pode paralisar um alvo por 1 turno (1x/descanso).", desc: "Pris√£o mental." }
          ]},
          { id: 'ps2', name: "Leitura Mental", icon: <Eye size={14}/>, levels: [
              { lv: 1, req: "Vencer 20 testes Intui√ß√£o", effect: "Pode sentir a presen√ßa de mentes a 9m.", desc: "Sussurros de pensamentos." },
              { lv: 2, req: "Ps1 + Detectar mentira", effect: "Vantagem em testes contra ilus√µes.", desc: "Vis√£o al√©m do v√©u." },
              { lv: 3, req: "Ps2 + Dominar mente", effect: "Pode lan√ßar 'Sugest√£o' 1x por descanso longo.", desc: "Manipulador de sonhos." }
          ]},
          { id: 'ps3', name: "Escudo Ps√≠quico", icon: <Shield size={14}/>, levels: [
              { lv: 1, req: "Dano Ps√≠quico sofrido", effect: "Resist√™ncia a dano Ps√≠quico.", desc: "Muralha cerebral." },
              { lv: 2, req: "Ps1 + Bloquear controle", effect: "Imunidade a ser Enfeiti√ßado (Charmed).", desc: "Vontade de ferro." },
              { lv: 3, req: "Ps2 + Refletir dor", effect: "Dano mental sofrido √© refletido ao atacante.", desc: "Espelho cognitivo." }
          ]},
          { id: 'ps4', name: "Salto Espacial", icon: <Footprints size={14}/>, levels: [
              { lv: 1, req: "Caminhar 100km", effect: "Pode se teleportar 1.5m em vez de andar.", desc: "Passo dimensional." },
              { lv: 2, req: "Ps1 + Teleporte cego", effect: "Pode usar 'Passo Misterioso' 1x/descanso.", desc: "Fenda na realidade." },
              { lv: 3, req: "Ps2 + Viajar planos", effect: "Pode trocar de lugar com um aliado (a√ß√£o b√¥nus).", desc: "Troca qu√¢ntica." }
          ]}
        ]
      }
    };

    function App() {
      const [user, setUser] = useState(null);
      const [view, setView] = useState('login');
      const [characterName, setCharacterName] = useState('');
      const [characterData, setCharacterData] = useState(null);
      const [allCharacters, setAllCharacters] = useState([]);
      const [loading, setLoading] = useState(true);
      const [tooltip, setTooltip] = useState({ show: false, content: null, x: 0, y: 0 });

      useEffect(() => {
        const initAuth = async () => {
          if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
            await auth.signInWithCustomToken(__initial_auth_token);
          } else {
            await auth.signInAnonymously();
          }
        };
        initAuth();
        auth.onAuthStateChanged(setUser);
        setLoading(false);
      }, []);

      useEffect(() => {
        if (!user) return;

        let unsubChar = () => {};
        if (characterName && characterName.toLowerCase() !== 'mestre') {
          const charRef = db
            .collection('artifacts').doc(appId)
            .collection('public').doc('data')
            .collection('characters').doc(characterName.toLowerCase());
          unsubChar = charRef.onSnapshot((snap) => {
            if (snap.exists) setCharacterData(snap.data());
            else charRef.set({ name: characterName, selectedTree: null, unlocked: {} });
          });
        }

        const q = db
          .collection('artifacts').doc(appId)
          .collection('public').doc('data')
          .collection('characters');
        const unsubAll = q.onSnapshot((snap) => {
          const chars = [];
          snap.forEach(d => chars.push(d.data()));
          setAllCharacters(chars);
        });

        return () => { unsubChar(); unsubAll(); };
      }, [user, characterName]);

      const saveCharacter = async (id, data) => {
        await db
          .collection('artifacts').doc(appId)
          .collection('public').doc('data')
          .collection('characters').doc(id.toLowerCase())
          .set(data);
      };

      const upgradeTalent = (talentId, level) => {
        const currentUnlocked = characterData.unlocked || {};
        const currentLv = currentUnlocked[talentId] || 0;
        if (level === currentLv + 1) {
          const updated = { ...characterData, unlocked: { ...currentUnlocked, [talentId]: level } };
          saveCharacter(characterName, updated);
        } else if (level === currentLv) {
          const updated = { ...characterData, unlocked: { ...currentUnlocked, [talentId]: level - 1 } };
          saveCharacter(characterName, updated);
        }
      };

      const showTooltip = (e, talentName, levelData) => {
        setTooltip({ show: true, content: { ...levelData, talentName }, x: e.clientX, y: e.clientY });
      };

      if (loading) return <div className="min-h-screen bg-slate-950 flex items-center justify-center text-amber-500 font-black italic animate-pulse tracking-widest">INVOCANDO GRIM√ìRIO...</div>;

      if (view === 'login') return (
        <div className="min-h-screen bg-slate-950 flex items-center justify-center p-4">
          <div className="bg-slate-900 border-2 border-slate-800 p-10 rounded-[3rem] w-full max-w-sm shadow-2xl relative overflow-hidden group">
            <div className="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-transparent via-amber-500 to-transparent group-hover:scale-x-150 transition-transform duration-1000"></div>
            <h1 className="text-3xl font-black text-center text-white mb-2 tracking-tighter uppercase italic">Arvore de Talento</h1>
            <p className="text-slate-500 text-center text-[10px] mb-10 uppercase font-bold tracking-[0.3em]">O Despertar de novas habilidades</p>
            <form onSubmit={(e) => { e.preventDefault(); setView(characterName.toLowerCase() === 'mestre' ? 'master' : 'character'); }} className="space-y-4">
              <input 
                type="text" placeholder="Nome do Personagem" 
                className="w-full bg-slate-800 border-slate-700 rounded-2xl p-4 text-white outline-none focus:ring-2 focus:ring-amber-500 transition-all font-bold"
                onChange={e => setCharacterName(e.target.value)}
              />
              <button className="w-full bg-amber-600 hover:bg-amber-500 text-white font-black p-4 rounded-2xl transition-all flex items-center justify-center gap-2 uppercase tracking-widest shadow-lg shadow-amber-900/20 active:scale-95">
                Selecionar Atributos <ChevronRight />
              </button>
            </form>
          </div>
        </div>
      );

      // --- VIEW: MESTRE (Guia de Perks Detalhada) ---
      if (view === 'master') return (
        <div className="min-h-screen bg-slate-950 text-slate-100 p-6">
          <header className="max-w-6xl mx-auto flex justify-between items-center mb-10 border-b border-slate-800 pb-6">
            <h1 className="text-3xl font-black flex items-center gap-3 italic uppercase tracking-tighter"><Users className="text-amber-500" /> Sala do Mestre</h1>
            <button onClick={() => setView('login')} className="bg-slate-800 px-6 py-2 rounded-xl text-xs font-black uppercase tracking-widest border border-slate-700 hover:bg-slate-700">Voltar</button>
          </header>
          <div className="max-w-6xl mx-auto grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            {allCharacters.map(char => {
              const tree = char.selectedTree ? TALENT_TREES[char.selectedTree] : null;
              return (
                <div key={char.name} className="bg-slate-900 border border-slate-800 rounded-[2.5rem] p-8 hover:border-amber-500/30 transition-all shadow-xl relative overflow-hidden group">
                  <div className="flex items-center gap-4 mb-6 border-b border-slate-800 pb-4">
                    <div className="w-12 h-12 bg-slate-800 rounded-2xl flex items-center justify-center text-amber-500 font-black text-xl shadow-inner border border-slate-700">{char.name[0]}</div>
                    <div>
                      <h3 className="text-2xl font-black uppercase tracking-tight text-white">{char.name}</h3>
                      <p className="text-[10px] text-amber-600 font-bold tracking-widest uppercase">{tree ? tree.title : "Iniciante"}</p>
                    </div>
                  </div>
                  <div className="space-y-4">
                    <h4 className="text-[10px] font-black text-slate-500 uppercase tracking-widest flex items-center gap-2"><Zap size={10}/> Perks Conquistados:</h4>
                    <div className="grid gap-3">
                      {Object.entries(char.unlocked || {}).map(([talentId, level]) => {
                        if (level === 0) return null;
                        const talentData = tree?.talents.find(t => t.id === talentId);
                        const levelInfo = talentData?.levels[level - 1];
                        return (
                          <div key={talentId} className="bg-slate-950/50 p-4 rounded-2xl border border-slate-800/50">
                            <div className="flex items-center justify-between mb-1">
                              <span className="text-[11px] font-black text-slate-200 uppercase flex items-center gap-2">
                                 {talentData?.icon} {talentData?.name} - NV {level}
                              </span>
                              <Star size={10} className="text-amber-500 fill-amber-500" />
                            </div>
                            <p className="text-[11px] text-green-400 font-black leading-tight mb-1">{levelInfo?.effect}</p>
                            <p className="text-[10px] text-slate-500 italic">"{levelInfo?.desc}"</p>
                          </div>
                        );
                      })}
                    </div>
                  </div>
                </div>
              );
            })}
          </div>
        </div>
      );

      // --- VIEW: JOGADOR ---
      const charTree = characterData?.selectedTree ? TALENT_TREES[characterData.selectedTree] : null;

      return (
        <div className="min-h-screen bg-slate-950 text-slate-100 pb-20 relative">
          {tooltip.show && (
            <div 
              className="fixed z-[100] pointer-events-none bg-slate-900 border border-slate-700 p-5 rounded-3xl shadow-[0_0_50px_rgba(0,0,0,0.8)] w-72 animate-in fade-in zoom-in-95"
              style={{ left: tooltip.x + 20, top: tooltip.y + 20 }}
            >
              <div className="flex items-center gap-2 mb-2">
                 <Star className="w-4 h-4 text-amber-500 fill-amber-500" />
                 <p className="text-amber-500 font-black uppercase text-xs tracking-tighter">{tooltip.content.talentName} {tooltip.content.lv ? `- NV ${tooltip.content.lv}` : ""}</p>
              </div>
              <p className="text-[11px] text-slate-400 italic mb-4 leading-relaxed">"{tooltip.content.desc}"</p>
              <div className="space-y-3 border-t border-slate-800 pt-3 text-[10px]">
                <div className="bg-red-950/20 p-2 rounded-lg border border-red-900/30">
                   <p className="font-black text-slate-500 uppercase tracking-widest mb-1">Desafio Requerido:</p>
                   <p className="text-red-400 font-bold">{tooltip.content.req}</p>
                </div>
                <div className="bg-green-950/20 p-2 rounded-lg border border-green-900/30">
                   <p className="font-black text-slate-500 uppercase tracking-widest mb-1">Efeito Recebido:</p>
                   <p className="text-green-400 font-black">{tooltip.content.effect}</p>
                </div>
              </div>
            </div>
          )}

          <header className="bg-slate-900/90 backdrop-blur-xl border-b border-slate-800 p-6 sticky top-0 z-40">
            <div className="max-w-6xl mx-auto flex justify-between items-center px-4">
              <div className="flex items-center gap-5">
                <div className="bg-slate-800 p-3 rounded-2xl border border-slate-700 shadow-inner"><User className="text-amber-500" /></div>
                <div>
                  <h2 className="text-3xl font-black uppercase tracking-tighter text-white drop-shadow-md">{characterData?.name}</h2>
                  <div className="flex items-center gap-2">
                     <div className="w-2 h-2 bg-green-500 rounded-full animate-pulse shadow-[0_0_8px_green]"></div>
                     <p className="text-slate-500 text-[10px] font-bold tracking-[0.2em] uppercase italic">Destino Aberto ‚Ä¢ N√≠vel 4</p>
                  </div>
                </div>
              </div>
              <button onClick={() => setView('login')} className="text-slate-500 hover:text-white text-[10px] font-black uppercase tracking-widest border border-slate-800 px-5 py-2 rounded-xl transition-all hover:bg-slate-800">Trocar Her√≥i</button>
            </div>
          </header>

          <main className="max-w-6xl mx-auto p-6 space-y-12 mt-4 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
            {!charTree && (
              <div className="col-span-full bg-gradient-to-br from-amber-900/30 to-slate-900 border border-amber-500/40 rounded-[3rem] p-10 flex items-start gap-8 shadow-2xl relative overflow-hidden group">
                <div className="absolute -right-10 -top-10 opacity-5 rotate-12 group-hover:rotate-45 transition-all duration-1000"><Scroll size={200} /></div>
                <AlertTriangle className="text-amber-500 shrink-0 w-10 h-10 mt-1" />
                <div className="relative z-10">
                  <h3 className="text-2xl font-black text-amber-500 mb-2 uppercase tracking-tight italic">O Despertar da Voca√ß√£o</h3>
                  <p className="text-slate-400 text-sm leading-relaxed max-w-2xl">
                    O n√≠vel 4 marca o in√≠cio da sua especializa√ß√£o. Escolha uma das **Oito Vertentes do Destino**. 
                    Cada √°rvore desbloqueia 4 talentos √∫nicos com 3 n√≠veis de evolu√ß√£o. 
                    <span className="block mt-4 text-white font-black underline decoration-amber-500 uppercase italic">A escolha √© permanente e selar√° as outras √°rvores para sempre nesta ficha.</span>
                  </p>
                </div>
              </div>
            )}

            {Object.entries(TALENT_TREES).map(([key, tree]) => {
              const isSelected = characterData?.selectedTree === key;
              const isBlocked = characterData?.selectedTree && !isSelected;

              return (
                <div 
                  key={key}
                  className={`
                    relative bg-slate-900 rounded-[3.5rem] border-2 p-10 transition-all duration-500 group flex flex-col h-full
                    ${isSelected ? `${tree.border} shadow-[0_0_80px_rgba(0,0,0,0.6)] scale-[1.03] z-10` : 'border-slate-800'}
                    ${isBlocked ? 'opacity-10 grayscale scale-90 pointer-events-none blur-[1px]' : 'hover:border-slate-500 cursor-pointer'}
                  `}
                  onClick={() => !isSelected && !isBlocked && saveCharacter(characterName, { ...characterData, selectedTree: key })}
                >
                  <div 
                    className="flex items-center gap-5 mb-8"
                    onMouseEnter={(e) => showTooltip(e, tree.title, { desc: tree.description, req: "Evolu√ß√£o Irrevers√≠vel", effect: "Acesso total aos talentos da vertente." })}
                    onMouseLeave={() => setTooltip({ ...tooltip, show: false })}
                  >
                    <div className={`${tree.color} p-5 rounded-3xl shadow-xl transition-all group-hover:rotate-6 group-hover:scale-110 border border-white/5`}>{tree.icon}</div>
                    <h3 className="text-2xl font-black uppercase tracking-tighter text-white group-hover:text-amber-500 transition-colors italic">{tree.title}</h3>
                  </div>

                  {isSelected ? (
                    <div className="space-y-10 animate-in fade-in slide-in-from-bottom-8 flex-grow">
                      <div className="flex items-center gap-3 text-green-500 text-[10px] font-black uppercase tracking-[0.3em] bg-green-950/20 w-fit px-5 py-2 rounded-full border border-green-500/20">
                        <CheckCircle2 size={14}/> Sincronizado
                      </div>
                      <div className="grid gap-8">
                      {tree.talents.map(talent => (
                        <div key={talent.id} className="space-y-4">
                          <div className="flex justify-between items-center bg-slate-950/40 p-4 rounded-2xl border border-slate-800/50 shadow-inner">
                            <h4 className="text-[11px] font-black text-slate-400 uppercase tracking-widest flex items-center gap-3 italic">
                               {talent.icon} {talent.name}
                            </h4>
                            <Info size={14} className="text-slate-700 hover:text-amber-500 cursor-help transition-colors" />
                          </div>
                          <div className="flex gap-3">
                            {talent.levels.map(level => {
                              const currentUnlocked = characterData.unlocked?.[talent.id] || 0;
                              const isAtivo = currentUnlocked >= level.lv;
                              const isDisponivel = level.lv === currentUnlocked + 1;
                              return (
                                <button
                                  key={level.lv}
                                  onMouseEnter={(e) => showTooltip(e, talent.name, level)}
                                  onMouseLeave={() => setTooltip({ ...tooltip, show: false })}
                                  onClick={(e) => { e.stopPropagation(); (isAtivo || isDisponivel) && upgradeTalent(talent.id, level.lv); }}
                                  className={`
                                    flex-1 py-4 rounded-[1.5rem] font-black text-sm transition-all border-2
                                    ${isAtivo ? `${tree.color} border-transparent text-white shadow-xl scale-[1.05]` : 
                                      isDisponivel ? `bg-slate-800 border-slate-700 text-slate-500 hover:${tree.border} hover:text-white shadow-lg` : 
                                      'bg-slate-950 border-transparent text-slate-800 cursor-not-allowed'}
                                  `}
                                >
                                  {level.lv === 1 ? 'I' : level.lv === 2 ? 'II' : 'III'}
                                </button>
                              );
                            })}
                          </div>
                        </div>
                      ))}
                      </div>
                    </div>
                  ) : (
                    <div className="space-y-8 flex-grow">
                      <p className="text-sm text-slate-500 leading-relaxed italic pr-4">"{tree.description}"</p>
                      <div className="mt-auto bg-slate-950/50 p-6 rounded-[2rem] border border-slate-800 text-center uppercase group-hover:border-amber-500/40 transition-all">
                        <span className="text-[10px] font-black text-amber-500 tracking-[0.3em] group-hover:text-amber-400">Selar Trilha</span>
                      </div>
                    </div>
                  )}
                </div>
              );
            })}
          </main>
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById('root')).render(<App />);
  </script>
</body>
</html>
